<mat-expansion-panel>
  <mat-expansion-panel-header>
    <mat-panel-title>
      {{ template.templateId }}
    </mat-panel-title>
  </mat-expansion-panel-header>

  <ng-template #spinner>
    <mat-progress-bar [color]="'accent'" mode="indeterminate"></mat-progress-bar>
  </ng-template>

  <mat-tree
    [dataSource]="nestedDataSource"
    [treeControl]="nestedTreeControl"
    class="num-tree"
    *ngIf="compositionId; else spinner"
  >
    <mat-tree-node *matTreeNodeDef="let node" matTreeNodeToggle>
      <ul>
        <li class="mat-tree-node" (dblclick)="handleItemDoubleClick(node)">
          <button mat-icon-button disabled></button>
          {{ node.displayName }}
        </li>
      </ul>
    </mat-tree-node>

    <mat-nested-tree-node *matTreeNodeDef="let node; when: hasChild">
      <ul>
        <li>
          <div class="mat-tree-node" (dblclick)="handleItemDoubleClick(node)">
            <button mat-icon-button matTreeNodeToggle>
              <fa-icon
                [icon]="'angle-right'"
                [rotate]="nestedTreeControl.isExpanded(node) ? 90 : 0"
              ></fa-icon>
            </button>
            {{ node.displayName }}
          </div>
          <ul [class.num-tree-invisible]="!nestedTreeControl.isExpanded(node)">
            <ng-container matTreeNodeOutlet></ng-container>
          </ul>
        </li>
      </ul>
    </mat-nested-tree-node>
  </mat-tree>
</mat-expansion-panel>
